<!DOCTYPE html>
<html>
  <!----------------- HEAD ------------------>
  <head>
    <meta charset="utf-8">
    <title>Blockly Demo: Toolbox</title>
    <script src="../blockly-buhorl/blockly_compressed.js"></script>
    <script src="../blockly-buhorl/blocks_compressed.js"></script>
    <script src="../blockly-buhorl//msg/js/en.js"></script>
    <script src="../blockly-buhorl/demos/blockfactory/blocks.js"></script>
    <script src="../blockly-buhorl/demos/blockfactory/factory_utils.js"></script>
    <script src="../blockly-buhorl/demos/blockfactory/factory.js"></script>
    <script src="plugins/require.js"></script>
    <script src="plugins/jquery-3.3.1.js"></script>
    <script src="components/editor.js"></script>
    <script src="blockly_loader.js"></script>

    <style>
      body {
        background-color: #fff;
        font-family: sans-serif;
      }
      h1 {
        font-weight: normal;
        font-size: 140%;
      }
    </style>

  </head>
  <!----------------- BODY ------------------>
  <body onload="init();">
    <!------- CONTENTS -------->
    <h1>Blockly / Bioblocks implementation</h1>
    <p>This is my demo for a custom toolbox that loads some blocks</p>
  <table>
    <tr><td width=100>
    <h4>Preview:
      <select id="direction">
        <option value="ltr">LTR</option>
        <option value="rtl">RTL</option>
      </select>
    </h4>
    </td>
    <td width=200>
    <h4>Block Definition:
      <select id="format">
        <option value="JSON">JSON</option>
        <option value="JavaScript">JavaScript</option>
        <option value="Manual-JSON">Manual JSON&hellip;</option>
        <script>
          if (document.location.href.indexOf('file://') == 0) {
            document.write(
                '<option value="Manual-JS">Manual JavaScript&hellip;</option>');
          }
        </script>
      </select>
    </h4>
    <td>
      <h4>Generator stub:
        <select id="language">
          <option value="JavaScript">JavaScript</option>
          <option value="Python">Python</option>
          <option value="PHP">PHP</option>
          <option value="Lua">Lua</option>
          <option value="Dart">Dart</option>
        </select>
      </h4>
    </td></tr>
  </table>
    <BUTTON id="custom_button_load">Load code from the workspace to the code-box</BUTTON>
    <br>
    <BUTTON id="custom_button_view">Load code from the code-box to the mirror</BUTTON>
    <br>
    <table>
      <tr>
        <td>
          <h3>Workspace</h3>
          <div id="blocklyDiv" style="height: 570px; width: 500px;"></div>
        </td>
        <td style="vertical-align:text-top">
          <h3>Mirror</h3>
          <div id="preview" style="height: 300px; width: 430px;"></div>
          <h3>Code-box</h3>
          <textarea id="languageTA" style="height: 200px; width: 430px;resize:none">Initial empty space: waiting for some code</textarea>
        </td>
      </tr>
    </table>
    <!------- TOOLBOXES -------->
    <xml id="toolbox_1" style="display: none">This toolbox gets automatically loaded, deprecated</xml>   
    <!------- SCRIPTS -------->
        <script>
    var blocklyFactory;
    var init = function() {
      //blocklyFactory = new MyController();
      MyController.js_init();
    };
    window.alert("Welcome to the custom editor")
  </script>
    <!--
    <script>

    </script>
    <script>
      var firstWS = document.getElementById('blocklyDiv')
      var secondWS = document.getElementById('preview')
      //No se hace la instanciaci√≥n porque si no se duplica en la carga desde el codigo
      /*var secondWS = Blockly.inject('preview',
        {readOnly: true,
        media: '../../media/',
        toolbox: document.getElementById('toolbox')});*/
      /*var firstWS = Blockly.inject('blocklyDiv',
        {media: '../../media/',
        toolbox: document.getElementById('toolbox')});*/
    </script>
    <script>
      // Listen to events on primary workspace.
      //firstWS.addChangeListener(mirrorEvent);
    function mirrorEvent(primaryEvent) {
      if (primaryEvent.type == Blockly.Events.UI) {
        return;  // Don't mirror UI events.
      }
      // Convert event to JSON.  This could then be transmitted across the net.
      var json = primaryEvent.toJson();
      console.log(json);
      // Convert JSON back into an event, then execute it.
      var secondaryEvent = Blockly.Events.fromJson(json, secondWS);
      secondaryEvent.run(true);
    }
    </script>
  -->
  </body>
</html>
