<!DOCTYPE html>
<html>
<head>  
  <meta charset="utf-8">
  <meta name="viewport" content="target-densitydpi=device-dpi, height=660, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Blockly Demo: Blockly Developer Tools</title>
  <script src="../../blockly_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../msg/js/en.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../../closure-library/closure/goog/base.js"></script>
  <script src="analytics.js"></script>
  <script src="block_definition_extractor.js"></script>
  <script src="factory_utils.js"></script>
  <script src="workspacefactory/wfactory_model.js"></script>
  <script src="standard_categories.js"></script>
  <script src="workspacefactory/wfactory_controller.js"></script>
  <script src="workspacefactory/wfactory_view.js"></script>
  <script src="workspacefactory/wfactory_generator.js"></script>
  <script src="workspacefactory/wfactory_init.js"></script>
  <script src="block_option.js"></script>
  <script src="factory.js"></script>
  <script src="block_library_view.js"></script>
  <script src="block_library_storage.js"></script>
  <script src="block_library_controller.js"></script>
  <script src="block_exporter_tools.js"></script>
  <script src="block_exporter_view.js"></script>
  <script src="block_exporter_controller.js"></script>
  <script src="blocks.js"></script>
  <script src="app_controller.js"></script>
  <script src="./custom_code/definitions.js"></script>

  <!--
  <script src="/storage.js"></script>-->
  <link rel="stylesheet" href="factory.css">
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <!--
  <script>
    var blocklyFactory;
    var init = function() {
      BlocklyDevTools.Analytics.init();

      blocklyFactory = new AppController();
      blocklyFactory.init();
      FactoryUtils.show('blockFactoryContent');
      window.alert(5 + 6);
      window.addEventListener('beforeunload', blocklyFactory.confirmLeavePage);
    };
    window.addEventListener('load', init);
  </script>-->
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <h1>Blockly / Bioblocks implementation</h1>

  <p>This is my demo for a custom toolbox that loads some blocks</p>
  <BUTTON>Button</BUTTON>

  <table width="100%">
    <tr>
      <td>
        <div id="primaryDiv" style="height: 480px; width: 600px;"></div>
      </td>
      <td>
        <div id="secondaryDiv" style="height: 480px; width: 430px;"></div>
      </td>
    </tr>
  </table>

  <xml id="toolbox" style="display: none">
    <category name="Input / Output">
      <block type="source"></block>
      <block type="destination"></block>
    </category>
    <category name="Number Inputs">
      <block type="numbers_time_of_op">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_speed">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_cycles">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_wavelength">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_sequence">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_co2">
        <field name="NAME">0</field>
      </block>
      <block type="numbers_speed">
        <field name="NAME">0</field>
      </block>
    </category>
    <category name="String Inputs">
      <block type="strings_ladder">
        <field name="NAME"> --- </field>
      </block>
      <block type="strings_dest">
        <field name="NAME"> --- </field>
      </block>
      <block type="strings_scale">
        <field name="NAME"> --- </field>
      </block>
      <block type="strings_purification">
        <field name="NAME"> --- </field>
      </block>
      <block type="strings_mcc">
        <field name="NAME"> --- </field>
      </block>
    </category>
    <category name="Dropdown Menus">
      <block type="drop_action">
        <field name="NAME">OPTIONNAME</field>
      </block>
      <block type="drop_measure">
        <field name="NAME">OPTIONNAME</field>
      </block>
      <block type="drop_type">
        <field name="NAME">OPTIONNAME</field>
      </block>
      <block type="drop_temp">
        <field name="NAME">OPTIONNAME</field>
        <field name="NUMBER">0</field>
      </block>
      <block type="drop_duration">
        <field name="NUMBER">0</field>
        <field name="NAME">OPTIONNAME</field>
      </block>
    </category>
    <category name="Extra">
      <block type="new_op">
        <field name="NAME"> --- </field>
      </block>
      <block type="extra_settings">
        <field name="NAME">TRUE</field>
      </block>
      <block type="extra_mix_check">
        <field name="NAME">TRUE</field>
      </block>
    </category>
  </xml>
<!-- --------------------------------------------- Some code/scripts ------------------------------------------------------- -->
  <script>
    // Inject primary workspace.
    var primaryWorkspace = Blockly.inject('primaryDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')});
    // Inject secondary workspace.
    var secondaryWorkspace = Blockly.inject('secondaryDiv',
        {media: '../../media/',
         readOnly: true});
    // Listen to events on primary workspace.
    primaryWorkspace.addChangeListener(mirrorEvent);

    function mirrorEvent(primaryEvent) {
      if (primaryEvent.type == Blockly.Events.UI) {
        return;  // Don't mirror UI events.
      }
      // Convert event to JSON.  This could then be transmitted across the net.
      var json = primaryEvent.toJson();
      console.log(json);
      // Convert JSON back into an event, then execute it.
      var secondaryEvent = Blockly.Events.fromJson(json, secondaryWorkspace);
      secondaryEvent.run(true);
    }
  </script>
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')});
  </script>

</body>
</html>
